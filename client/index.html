<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Gold Pixel ‚Äî JeuxVideo.Pi</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    /* Palette de couleurs mise √† jour selon nos √©changes */
    :root { 
        --bg:#080a0c; 
        --panel:#10141d; 
        --text:#e7eef8; 
        --muted:#6b7c93; 
        --stroke:#1e2633; 
        --primary:#f1c40f; /* Couleur Gold */
        --matte-bg: #1a1a1a;
        --shine-bg: linear-gradient(135deg, #2c3e50, #000);
        --gold-glow: 0 0 15px rgba(241, 196, 15, 0.4);
    }

    body { margin:0; font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); display:flex; height:100vh; overflow: hidden; }
    
    /* Barre lat√©rale gauche */
    .left { width: 320px; padding:20px; border-right:1px solid var(--stroke); background: var(--panel); z-index: 10; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; }
    h1 { color: var(--primary); font-size: 24px; margin: 0 0 10px 0; text-align: center; letter-spacing: 1px; text-shadow: var(--gold-glow); }

    .card { border:1px solid var(--stroke); background: rgba(255,255,255,0.02); border-radius:12px; padding:15px; }
    .label { font-size: 10px; text-transform: uppercase; color: var(--muted); margin-bottom: 8px; letter-spacing: 1px; font-weight: bold; }
    
    /* Syst√®me de recharge de pixels */
    .pixel-counter { display: flex; align-items: center; justify-content: space-between; margin-bottom: 5px; }
    .pixel-bar-bg { background: #000; height: 10px; border-radius: 5px; width: 100%; border: 1px solid var(--stroke); overflow: hidden; }
    .pixel-bar-fill { background: var(--primary); height: 100%; width: 50%; transition: width 0.3s; box-shadow: var(--gold-glow); }

    /* Palettes Matte & Shine */
    .tabs { display: flex; gap: 5px; margin-bottom: 10px; }
    .tab { flex: 1; padding: 6px; font-size: 11px; text-align: center; cursor: pointer; border-radius: 4px; background: var(--matte-bg); border: 1px solid var(--stroke); color: var(--muted); }
    .tab.active { background: var(--stroke); color: #fff; border-color: var(--primary); }

    .swatches { display:grid; grid-template-columns: repeat(4, 1fr); gap:8px; }
    .swatch { aspect-ratio: 1/1; border-radius:4px; cursor:pointer; border: 2px solid transparent; transition: transform 0.1s; position: relative; }
    .swatch:hover { transform: scale(1.1); }
    .swatch.active { border-color: #fff; box-shadow: 0 0 8px rgba(255,255,255,0.5); }
    
    /* Effet sp√©cifique pour le pixel Gold dans la palette Shine */
    .swatch.gold-pixel { border: 2px solid var(--primary); box-shadow: var(--gold-glow); animation: pulse 2s infinite; }
    @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }

    /* Boutique & Actions */
    .btn { background: var(--stroke); color: #fff; border: 1px solid var(--stroke); padding: 10px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; text-align: center; transition: 0.2s; }
    .btn:hover { border-color: var(--primary); color: var(--primary); }
    .btn-gold { background: var(--primary); color: #000; border: none; }

    .status { padding:8px; border-radius:6px; text-align: center; font-size: 12px; border: 1px solid #27ae60; color: #27ae60; background: rgba(39, 174, 96, 0.1); }

    .main { flex:1; position:relative; background:#05070a; display:flex; align-items:center; justify-content:center; }
    canvas { background: #000; border: 2px solid var(--stroke); cursor: crosshair; image-rendering: pixelated; box-shadow: 0 0 40px rgba(0,0,0,0.5); }
  </style>
</head>
<body>
  <aside class="left">
    <h1>GOLD PIXEL</h1>
    
    <div class="card">
      <div class="label">Abonnement</div>
      <div id="current-pack" style="color:var(--primary); font-weight: bold; font-size: 14px;">Pack Essentiel</div>
      <div style="font-size: 11px; color: var(--muted); margin-top: 4px;">Reset dans : 18 jours</div>
    </div>

    <div class="card">
        <div class="pixel-counter">
            <div class="label" style="margin:0">Stock Pixels</div>
            <span id="pixel-count" style="font-weight: bold; color: var(--primary);">12 / 15</span>
        </div>
        <div class="pixel-bar-bg">
            <div id="pixel-progress" class="pixel-bar-fill" style="width: 80%;"></div>
        </div>
        <div style="font-size: 10px; color: var(--muted); margin-top: 8px; text-align: right;">+1 px toutes les 4 min</div>
    </div>

    <div class="card">
      <div class="tabs">
        <div class="tab active" onclick="switchPalette('matte')">MATTE</div>
        <div class="tab" onclick="switchPalette('shine')">SHINE ‚ú®</div>
      </div>
      <div id="palette" class="swatches"></div>
    </div>

    <div class="card" style="display: flex; flex-direction: column; gap: 8px;">
        <div class="label">Boutique (Pi)</div>
        <div class="btn btn-gold">Solde : 1.5 Pi</div>
        <div class="btn">üõ°Ô∏è D√¥me 4H (0.5 Pi)</div>
        <div class="btn">üéØ Pack Vengeance (1 Pi)</div>
    </div>

    <div class="status">‚óè Serveur Connect√©</div>
  </aside>

  <main class="main">
    <canvas id="grille" width="512" height="512"></canvas>
  </main>

<script>
  const socket = io("http://localhost:3000", { transports: ['websocket'] });
  const canvas = document.getElementById("grille");
  const ctx = canvas.getContext("2d");
  
  let selectedColor = "#FF0000";
  let currentPalette = 'matte';

  // D√©finition des palettes selon nos validations
  const palettes = {
    matte: ["#FF0000", "#00FF00", "#0000FF", "#FFFF00", "#FFA500", "#FF00FF", "#00FFFF", "#8B4513", "#FFFFFF", "#000000", "#808080", "#FFC0CB", "#008000", "#000080", "#800000", "#4B0082"],
    shine: ["#FFD700", "#C0C0C0", "#CD7F32", "#E5E4E2", "#FF007F", "#00FFEF", "#7FFF00", "#BF00FF"] // On compl√®tera avec les textures
  };

  const paletteDiv = document.getElementById("palette");

  function renderPalette() {
    paletteDiv.innerHTML = "";
    palettes[currentPalette].forEach(color => {
      const div = document.createElement("div");
      div.className = "swatch";
      if (color === "#FFD700") div.classList.add("gold-pixel"); // Effet sp√©cial Gold
      div.style.background = color;
      if(color === selectedColor) div.classList.add("active");
      
      div.onclick = () => {
        selectedColor = color;
        document.querySelectorAll(".swatch").forEach(s => s.classList.remove("active"));
        div.classList.add("active");
      };
      paletteDiv.appendChild(div);
    });
  }

  function switchPalette(type) {
    currentPalette = type;
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    event.target.classList.add("active");
    renderPalette();
  }

  // Initialisation
  renderPalette();

  socket.on('init_canvas', (data) => {
    for(let i=0; i < data.length / 3; i++) {
      ctx.fillStyle = `rgb(${data[i*3]}, ${data[i*3+1]}, ${data[i*3+2]})`;
      ctx.fillRect(i % 512, Math.floor(i / 512), 1, 1);
    }
  });

  socket.on('pixel_update', ({x, y, color}) => {
    ctx.fillStyle = `rgb(${color[0]}, ${color[1]}, ${color[2]})`;
    ctx.fillRect(x, y, 1, 1);
  });

  canvas.addEventListener("click", (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = Math.floor((e.clientX - rect.left) / (rect.width / 512));
    const y = Math.floor((e.clientY - rect.top) / (rect.height / 512));
    
    // Conversion Hex vers RGB pour l'envoi socket
    const r = parseInt(selectedColor.slice(1,3), 16), 
          g = parseInt(selectedColor.slice(3,5), 16), 
          b = parseInt(selectedColor.slice(5,7), 16);
    
    socket.emit('claim_pixel', { x, y, color: [r, g, b] });
  });
</script>
</body>
</html>
