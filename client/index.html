<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Gold Pixel — JeuxVideo.Pi</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    :root { --bg:#0b0f14; --panel:#121926; --text:#e7eef8; --muted:#9fb0c5; --stroke:#223047; --primary:#2f6fed; --success:#00ff00; }
    body { margin:0; font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); display:flex; height:100vh; overflow: hidden; }
    .left { width: 320px; padding:20px; border-right:1px solid var(--stroke); background: var(--panel); z-index: 10; display: flex; flex-direction: column; gap: 15px; }
    .card { border:1px solid var(--stroke); background: rgba(255,255,255,0.03); border-radius:12px; padding:15px; }
    .label { font-size: 11px; text-transform: uppercase; color: var(--muted); margin-bottom: 10px; letter-spacing: 0.5px; }
    .swatches { display:grid; grid-template-columns: repeat(4, 1fr); gap:8px; }
    .swatch { aspect-ratio: 1/1; border-radius:6px; cursor:pointer; border: 2px solid rgba(255,255,255,0.1); transition: transform 0.1s; }
    .swatch:hover { transform: scale(1.05); }
    .swatch.active { border-color: white; box-shadow: 0 0 10px rgba(255,255,255,0.3); }
    .status { padding:12px; border-radius:8px; text-align: center; font-weight: bold; border: 1px solid var(--success); color: var(--success); background: rgba(0, 255, 0, 0.05); }
    .main { flex:1; position:relative; background:#0a0f16; display:flex; align-items:center; justify-content:center; }
    canvas { background: #161b22; border: 1px solid var(--stroke); cursor: crosshair; image-rendering: pixelated; }
  </style>
</head>
<body>
  <aside class="left">
    <h1>Gold Pixel</h1>
    <div class="card">
      <div class="label">Pack Actif</div>
      <div style="background:var(--primary); padding:10px; border-radius:8px; text-align:center; font-weight: 600;">Pack Essentiel (60s)</div>
    </div>
    <div class="card">
      <div class="label">Couleurs</div>
      <div id="palette" class="swatches"></div>
    </div>
    <div class="status">✅ Connecté</div>
  </aside>
  <main class="main">
    <canvas id="grille" width="512" height="512"></canvas>
  </main>
<script>
  const socket = io("http://localhost:3000", { transports: ['websocket'] });
  const canvas = document.getElementById("grille");
  const ctx = canvas.getContext("2d");
  let selectedColor = "#FF0000";
  const couleurs = ["#FFFFFF", "#000000", "#FF0000", "#00FF00", "#0000FF", "#FFFF00", "#FFA500", "#FF00FF", "#00FFFF", "#8B4513", "#808080", "#FFC0CB"];

  // Palette
  const paletteDiv = document.getElementById("palette");
  couleurs.forEach(color => {
    const div = document.createElement("div");
    div.className = "swatch";
    div.style.background = color;
    if(color === selectedColor) div.classList.add("active");
    div.onclick = () => {
      selectedColor = color;
      document.querySelectorAll(".swatch").forEach(s => s.classList.remove("active"));
      div.classList.add("active");
    };
    paletteDiv.appendChild(div);
  });

  socket.on('init_canvas', (data) => {
    for(let i=0; i < data.length / 3; i++) {
      ctx.fillStyle = `rgb(${data[i*3]}, ${data[i*3+1]}, ${data[i*3+2]})`;
      ctx.fillRect(i % 512, Math.floor(i / 512), 1, 1);
    }
  });

  socket.on('pixel_update', ({x, y, color}) => {
    ctx.fillStyle = `rgb(${color[0]}, ${color[1]}, ${color[2]})`;
    ctx.fillRect(x, y, 1, 1);
  });

  canvas.addEventListener("click", (e) => {
    const rect = canvas.getBoundingClientRect();
    const x = Math.floor((e.clientX - rect.left) / (rect.width / 512));
    const y = Math.floor((e.clientY - rect.top) / (rect.height / 512));
    const r = parseInt(selectedColor.slice(1,3), 16), g = parseInt(selectedColor.slice(3,5), 16), b = parseInt(selectedColor.slice(5,7), 16);
    socket.emit('claim_pixel', { x, y, color: [r, g, b] });
  });
</script>
</body>
</html>
